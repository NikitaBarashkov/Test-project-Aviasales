(()=>{"use strict";function t(t,e){return t.price<e.price?-1:t.price>e.price?1:0}function e(t,e){return(t.segments[0].duration+t.segments[1].duration)/2<(e.segments[0].duration+e.segments[1].duration)/2?-1:(t.segments[0].duration+t.segments[1].duration)/2>(e.segments[0].duration+e.segments[1].duration)/2?1:0}function n(t){return{firstHalf:{timeWay:()=>{const e=(t.segments[0].duration/60).toString().split(".");let n=e[0],s=e[1].slice(0,2);if(s>59){let t=(s/60).toString().split(".");n=+n+ +t[0],s=t[1].slice(0,2),e.splice(0,2,n,s)}return e},price:t.price.toString().slice(0,2)+" "+t.price.toString().slice(2)+" P",carrier:t.carrier,origin:t.segments[0].origin,destination:t.segments[0].destination,conutStops:t.segments[0].stops.length,stopPoints:t.segments[0].stops.join(","),startDate:t.segments[0].date,endDate:function(){const t=36e5*this.timeWay()[0]+6e4*this.timeWay()[1].slice(0,2);return+Date.parse(this.startDate)+t}},secondHalf:{timeWay:()=>{const e=(t.segments[1].duration/60).toString().split(".");let n=e[0],s=e[1].slice(0,2);if(s>59){let t=(s/60).toString().split(".");n=+n+ +t[0],s=t[1].slice(0,2),e.splice(0,2,n,s)}return e},origin:t.segments[1].origin,destination:t.segments[1].destination,conutStops:t.segments[1].stops.length,stopPoints:t.segments[1].stops.join(","),startDate:t.segments[1].date,endDate:function(){const t=36e5*this.timeWay()[0]+6e4*this.timeWay()[1].slice(0,2);return+Date.parse(this.startDate)+t}}}}const s=document.querySelector(".btn_cheap-tickets"),i=document.querySelector(".btn_fast-tickets"),a=document.querySelector(".options"),o=document.querySelector(".options__btn");async function r(){const s=document.querySelectorAll(".ticket");s&&s.forEach((t=>t.remove()));const i=await fetch("http://localhost:3000/tickets"),a=await i.json();if(a){const s=function(t,e){if(e.allTickets)return t;const n=Object.entries(e).filter((t=>!0===t[1])).flat().filter((t=>"string"==typeof t)).map((t=>+t));return t.filter((t=>n.includes(t.segments[0].stops.length)&&n.includes(t.segments[1].stops.length)))}(a,function(){const t=document.querySelectorAll(".checkbox_hid");return{allTickets:t[0].checked,0:t[1].checked,1:t[2].checked,2:t[3].checked,3:t[4].checked}}());document.querySelector(".btn_cheap-tickets").classList.contains("btn_active")?s.sort(t):s.sort(e);const i=s.slice(0,5);for(let t in i){o=n(i[t]),document.querySelector(".content").insertAdjacentHTML("beforeend",`\n  <div class="ticket">\n    <div class="ticket__price">\n      <h3>${o.firstHalf.price}</h3>\n      <img src="http://pics.avs.io/99/36/${o.firstHalf.carrier}.png" alt="carrier">  \n    </div>\n    <div class="ticket__info">\n      <h3 class="info">\n        ${o.firstHalf.origin} - ${o.firstHalf.destination}<br>\n        <span>\n          ${1==new Date(o.firstHalf.startDate).getHours().toString().length?"0"+new Date(o.firstHalf.startDate).getHours():new Date(o.firstHalf.startDate).getHours()}:${1==new Date(o.firstHalf.startDate).getMinutes().toString().length?"0"+new Date(o.firstHalf.startDate).getMinutes():new Date(o.firstHalf.startDate).getMinutes()} -\n          ${1==new Date(o.firstHalf.endDate()).getHours().toString().length?"0"+new Date(o.firstHalf.endDate()).getHours():new Date(o.firstHalf.endDate()).getHours()}:${1==new Date(o.firstHalf.endDate()).getMinutes().toString().length?"0"+new Date(o.firstHalf.endDate()).getMinutes():new Date(o.firstHalf.endDate()).getMinutes()}\n        </span>\n      </h3>\n      <h3 class="info">\n        В ПУТИ<br>\n        <span>${o.firstHalf.timeWay()[0]}ч ${o.firstHalf.timeWay()[1].slice(0,2)}м</span>\n      </h3>\n      <h3 class="info">\n        ${o.firstHalf.conutStops?o.firstHalf.conutStops:"БЕЗ"} \n        ${1==o.firstHalf.conutStops?"ПЕРЕСАДКА":2==o.firstHalf.conutStops||3==o.firstHalf.conutStops?"ПЕРЕСАДКИ":"ПЕРЕСАДОК"}\n        <br>\n        <span>${o.firstHalf.conutStops?o.firstHalf.stopPoints:""}</span>\n      </h3>\n    </div>\n    <div class="ticket__info">\n      <h3 class="info">\n        ${o.secondHalf.origin} - ${o.secondHalf.destination}<br>\n        <span>\n        ${1==new Date(o.secondHalf.startDate).getHours().toString().length?"0"+new Date(o.secondHalf.startDate).getHours():new Date(o.secondHalf.startDate).getHours()}:${1==new Date(o.secondHalf.startDate).getMinutes().toString().length?"0"+new Date(o.secondHalf.startDate).getMinutes():new Date(o.secondHalf.startDate).getMinutes()} -\n      ${1==new Date(o.secondHalf.endDate()).getHours().toString().length?"0"+new Date(o.secondHalf.endDate()).getHours():new Date(o.secondHalf.endDate()).getHours()}:${1==new Date(o.secondHalf.endDate()).getMinutes().toString().length?"0"+new Date(o.secondHalf.endDate()).getMinutes():new Date(o.secondHalf.endDate()).getMinutes()}\n        </span>\n      </h3>\n      <h3 class="info">\n        В ПУТИ<br>\n        <span>${o.secondHalf.timeWay()[0]}ч ${o.secondHalf.timeWay()[1].slice(0,2)}м</span>\n      </h3>\n      <h3 class="info">\n        ${o.secondHalf.conutStops?o.secondHalf.conutStops:"БЕЗ"} \n        ${1==o.secondHalf.conutStops?"ПЕРЕСАДКА":2==o.secondHalf.conutStops||3==o.secondHalf.conutStops?"ПЕРЕСАДКИ":"ПЕРЕСАДОК"}\n        <br>\n        <span>${o.secondHalf.conutStops?o.secondHalf.stopPoints:""}</span>\n     </h3>\n    </div>\n  </div>\n  `)}}var o}window.addEventListener("load",(()=>{r()})),document.querySelector(".btn-block").addEventListener("click",(t=>{t.target.classList.contains("btn_active")||(s.classList.toggle("btn_active"),i.classList.toggle("btn_active"),r())})),document.querySelectorAll(".checkbox_hid").forEach((t=>{t.addEventListener("change",r)})),o.addEventListener("click",(()=>{o.classList.toggle("options__btn_active"),a.classList.toggle("options_active")}))})();